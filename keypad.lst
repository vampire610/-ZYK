C51 COMPILER V9.01   KEYPAD                                                                08/12/2018 22:02:29 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE KEYPAD
OBJECT MODULE PLACED IN keypad.obj
COMPILER INVOKED BY: D:\keil4\C51\BIN\C51.EXE code\my\keypad.c BROWSE INCDIR(.\code;.\code\my) DEBUG OBJECTEXTEND PRINT(
                    -.\keypad.lst) OBJECT(keypad.obj)

line level    source

   1          #include"keypad.h"
   2          
   3          uchar  g_uiCurrKey;            //å½“å‰æŒ‰é”®å€¼
   4          uchar  g_uiLastKey;            //ä¸Šæ¬¡æŒ‰é”®å€¼
   5          uchar  g_uiKeyScanCount;       //æŒ‰é”®æ‰«æè®¡æ•°ï¼Œä½œç”¨ï¼šæ¶ˆæŠ–åŠ¨
   6          
   7          uchar  g_uiPreKeyValue;        // ä¸Šä¸€æ¬¡çš„æœ‰æ•ˆæŒ‰é”®å€¼
   8          uchar  g_uiKeyDown;            //é”®è¢«æŒ‰ä¸‹ï¼Œè¿”å›çš„é”®å€¼ã€‚       ä½œç”¨ï¼šå•æ¬¡æŒ‰é”®ï¼Œå•æ¬¡è¿”
             -å›æœ‰æ•ˆé”®å€¼ï¼›æŒ‰ä½ä¸æ”¾ï¼Œä¹Ÿåªè¿”å›è¢«æŒ‰ä¸‹çš„ä¸€ä¸ªé”®å€¼
   9          uchar  g_uiKeyRelease;         //é”®è¢«é‡Šæ”¾åï¼Œè¿”å›çš„é”®å€¼ã€‚     ä½œç”¨ï¼šåªæœ‰æŒ‰ä¸‹çš„æŒ‰é”®è¢
             -«é‡Šæ”¾åï¼Œæ‰è¿”å›æŒ‰ä¸‹çš„é”®å€¼
  10          uchar  g_uiKeyContinue;        //é”®è¿ç»­æŒ‰é”®ï¼Œé‡å¤è¿”å›çš„é”®å€¼ã€‚ ä½œç”¨ï¼šåªè¦æŒ‰ä½ä¸æ”¾ï¼Œ
             -å°±ä¼šé‡å¤åœ°è¿”å›ç›¸åŒé”®å€¼
  11          
  12          void shezhi(uchar a)
  13          {
  14   1          if(setshijian==1||setnaozhong==1)
  15   1          {
  16   2              zset[flashwei]=a;
  17   2              flashwei--;
  18   2              if(flashwei==-1)
  19   2                  flashwei=0;
  20   2              flashtime=300;
  21   2          }
  22   1      }
  23          
  24          void Backspace()
  25          {
  26   1              if(setshijian==1||setnaozhong==1)
  27   1          {
  28   2              flashwei++;
  29   2              if(flashwei>5)
  30   2                  flashwei=5;
  31   2              flashtime=300;
  32   2          }
  33   1      }
  34          
  35          void qingchu()
  36          {
  37   1              zset[0]=0;
  38   1              zset[1]=0;
  39   1              zset[2]=0;
  40   1              zset[3]=0;
  41   1              zset[4]=0;
  42   1              zset[5]=0;
  43   1              flashwei=5;
  44   1      }
  45          
  46          
  47          void querenjian(Time * nao,Time * shij,Time *she)
  48          {
  49   1      
  50   1              if(setnaozhong==1)
  51   1              {
C51 COMPILER V9.01   KEYPAD                                                                08/12/2018 22:02:29 PAGE 2   

  52   2                      nao->miao=she->miao;
  53   2                      nao->fen=she->fen;
  54   2                      nao->shi=she->shi;
  55   2              }
  56   1              else if(setshijian==1)
  57   1              {
  58   2                      shij->miao=she->miao;
  59   2                      shij->fen=she->fen;
  60   2                      shij->shi=she->shi;
  61   2              }
  62   1      }
  63          
  64          void Int_Key_Scan(void)
  65          {
  66   1          static unsigned short LastReadKey;        //ä¸Šæ¬¡ä»IOå£è¯»å–çš„é”®å€¼ ,æ³¨æ„æ˜¯é™æ€å˜é‡
  67   1          unsigned short CurrReadKey;               //å½“å‰ä»IOå£è¯»å–çš„é”®å€¼
  68   1      
  69   1      //---------------------- éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ --------------------------------------//
  70   1          unsigned short KeyRow,KeyColumn;
  71   1      
  72   1          //è¯»å–æŒ‰é”®çš„è¡Œæ•°
  73   1          P1 = 0xf0;
  74   1          KeyRow = P1;
  75   1      
  76   1          //è¯»å–æŒ‰é”®çš„åˆ—æ•°
  77   1          P1 = 0x0f;
  78   1          KeyColumn = P1;
  79   1      
  80   1          P1=0xff;
  81   1          //è¯»å–è¡Œåˆ—æ•°ï¼Œå°±æ˜¯å½“å‰é”®å€¼äº†
  82   1          CurrReadKey = KeyRow|KeyColumn;         //è·å–å½“å‰çš„é”®å€¼      
  83   1          //P3=CurrReadKey;
  84   1      //-----------------------------------------------------------------------//
  85   1      
  86   1          if(CurrReadKey == LastReadKey)            //å¦‚æœå½“å‰è¯»å–çš„é”®å€¼ä¸ä¸Šæ¬¡ä»IOå£è¯»å–çš„é”®å€
             -¼ç›¸åŒ
  87   1          {
  88   2              if(1/*g_uiKeyScanCount >= KEYDEBOUNCE*/)   //é¦–å…ˆåˆ¤æ–­æ˜¯å¦å¤§äºç­‰äºdebounceçš„è®¾å®šå€¼(å
             -³æ˜¯ï¼Œæ˜¯å¦å¤§äºç­‰äºè®¾å®šçš„é‡‡æ ·æ¬¡æ•°)
  89   2              {
  90   3                  //æŒ‰ä½ä¸æ”¾,å¤šæ¬¡å“åº”
  91   3                  g_uiCurrKey = CurrReadKey;                //å¦‚æœæ˜¯,å°†å½“å‰çš„è¯»å–å€¼åˆ¤å®šä¸ºæœ‰æ•ˆæŒ‰é
             -”®å€¼(å¦‚æœæ˜¯ï¼Œåœ¨é‡‡æ ·å‘¨æœŸä¸­ï¼Œéƒ½æ˜¯è¿™ä¸ªå€¼ï¼Œåˆ™åˆ¤å®šä¸ºæœ‰æ•ˆæŒ‰é”®å€¼)
  92   3                  g_uiKeyContinue = g_uiCurrKey ;           //é•¿æŒ‰ï¼Œå¤šæ¬¡å“åº” æŒ‰é”®å€¼
  93   3                  //æŒ‰ä½ä¸æ”¾åªå“åº”ä¸€æ¬¡
  94   3                  if(g_uiPreKeyValue == g_uiCurrKey)
  95   3                  {
  96   4                      g_uiKeyDown = 0xff;                    //æ²¡æœ‰é”®å€¼
  97   4                  }
  98   3                  else
  99   3                  {
 100   4                      g_uiKeyDown = g_uiCurrKey;             //å¦‚æœä¸åŒï¼ŒæŒ‰é”®æœ‰æ•ˆ,(å°±æ˜¯ç¬¬ä¸€æ¬¡æœ‰æ•
             -ˆå€¼æ—¶)
 101   4                  }
 102   3      
 103   3                  //æŒ‰é”®é‡Šæ”¾æ—¶ï¼ŒæŒ‰é”®å€¼æ‰æœ‰æ•ˆ     
 104   3                  if(g_uiCurrKey == 0xff)                  //å½“æœ‰æ•ˆæŒ‰é”®å€¼ä»é0åˆ°0çš„çŠ¶æ€æ—¶(å³æ˜¯ï¼Œ
             -ä»æœ‰æŒ‰é”®åˆ°æ— æŒ‰é”®ï¼Œè¡¨ç¤ºå·²ç»é‡Šæ”¾äº†)ï¼Œè¡¨ç¤ºä¹‹å‰æŒ‰é”®å·²ç»é‡Šæ”¾äº†
 105   3                  {
 106   4                      g_uiKeyRelease = g_uiPreKeyValue;
 107   4                  }
 108   3      
C51 COMPILER V9.01   KEYPAD                                                                08/12/2018 22:02:29 PAGE 3   

 109   3                  g_uiPreKeyValue = g_uiCurrKey;               //è®°å½•ä¸Šæ¬¡æœ‰æ•ˆæŒ‰é”®å€¼
 110   3              }
 111   2              else                                       //å¦‚æœå¦ï¼Œåˆ™debounceåŠ ä¸€(å¦‚æœå¦ï¼Œåˆ™ç»§ç»­é‡
             -‡æ ·é”®å€¼)
 112   2              {
 113   3                  g_uiKeyScanCount++;
 114   3              }
 115   2          }
 116   1          else                                          //å¦‚æœå½“å‰è¯»å–çš„é”®å€¼ä¸ä¸Šæ¬¡ä»IOå£è¯»å–çš„é
             -”®å€¼ä¸åŒï¼Œè¯´æ˜æŒ‰é”®å·²ç»å˜åŒ–
 117   1          {
 118   2              g_uiKeyDown = 0xff;                       //æ”¾å¼€æŒ‰é”®åç¬¬ä¸€æ¬¡è¿›å…¥æ‰«æç¨‹åºï¼Œæ¸…é›¶g_u
             -iKeyDown.ä½œç”¨ï¼šæ¶ˆé™¤ä¸€ä¸ªBUGï¼ˆä½ çŒœBUGæ˜¯ä»€ä¹ˆï¼Ÿï¼‰
 119   2              g_uiKeyScanCount = 0;                     //æ¸…é›¶ä¹‹å‰çš„æŒ‰é”®çš„debounceè®¡æ•°
 120   2              LastReadKey = CurrReadKey;                //å°†å½“å‰è¯»å–çš„é”®å€¼è®°å½•ä¸ºä¸Šæ¬¡è¯»å–çš„æŒ‰é”®
             -å€¼
 121   2          }   
 122   1      }
 123          
 124          void keypad(void)
 125          {
 126   1          
 127   1              //ç¬¬ä¸€ç§ï¼šKeyDownçš„ä½¿
 128   1              //å•æŒ‰æ—¶å’Œé•¿æŒ‰æ—¶ï¼Œéƒ½åªè¿”å›ä¸€æ¬¡æœ‰æ•ˆé”®å€¼ï¼ˆæ— éœ€ç­‰åˆ°æŒ‰é”®é‡Šæ”¾ï¼Œå°±å¯ä»¥è¿”
             -å›æœ‰æ•ˆé”®å€¼ï¼‰
 129   1              switch(g_uiKeyDown)
 130   1              {
 131   2                  case 0xEE://7
 132   2                             {
 133   3                                      shezhi(7);
 134   3                             }
 135   2                              break;
 136   2      
 137   2                  case 0xED://8
 138   2                              {
 139   3                                      shezhi(8);
 140   3                             }
 141   2                              
 142   2                              break;
 143   2      
 144   2                  case 0xEB://9
 145   2                               {
 146   3                                      shezhi(9);
 147   3                             }
 148   2                              
 149   2                              break;
 150   2      
 151   2                  case 0xE7://é—¹é’Ÿå¼€å…³
 152   2                  {
 153   3                      if(naozhongflag==1)naozhongflag=0;
 154   3                      else if(naozhongflag==0)naozhongflag=1;
 155   3                  }
 156   2                              break;
 157   2      
 158   2                  case 0xDE://4
 159   2                              {
 160   3                                      shezhi(4);
 161   3                             }
 162   2                              break;
 163   2      
 164   2                  case 0xDD://5
 165   2                              {
C51 COMPILER V9.01   KEYPAD                                                                08/12/2018 22:02:29 PAGE 4   

 166   3                                      shezhi(5);
 167   3                             }
 168   2                              break;
 169   2      
 170   2                  case 0xDB://6
 171   2                              {
 172   3                                      shezhi(6);
 173   3                             }
 174   2                              break;
 175   2      
 176   2                  case 0xD7://æ—¶é—´è®¾ç½®
 177   2                  {
 178   3                      flashwei=5;
 179   3                      zhuancun(ptime,pzset);
 180   3                      setshijian=1;
 181   3                      flash=1;
 182   3                  }
 183   2                              break;   
 184   2      
 185   2                  case 0xBE://1
 186   2                             {
 187   3                                      shezhi(1);
 188   3                             }
 189   2                             break;
 190   2      
 191   2                  case 0xBD://2
 192   2                             {
 193   3                                      shezhi(2);
 194   3                             }
 195   2                             break;
 196   2      
 197   2                  case 0xBB://3
 198   2                              {
 199   3                                      shezhi(3);
 200   3                             }
 201   2                             break;
 202   2      
 203   2                  case 0xB7://é—¹é’Ÿè®¾ç½®
 204   2                  {
 205   3                      flashwei=5;
 206   3                      zhuancun(pnaotime,pzset);
 207   3                      setnaozhong=1;
 208   3                      flash=1;
 209   3                   
 210   3                  }
 211   2                             break; 
 212   2      
 213   2                  case 0x7E://ç¡®è®¤    å‚¨å­˜è®¾ç½®ï¼Œé€€å‡ºè®¾ç½®
 214   2                  {
 215   3                      nicun(psettime,pzset);
 216   3                      querenjian(pnaotime,ptime,psettime);
 217   3                      setnaozhong=0;
 218   3                      setshijian=0;
 219   3                      flash=0;
 220   3                      flashwei=0;
 221   3                  }
 222   2                             break;
 223   2      
 224   2                  case 0x7D://0
 225   2                              {
 226   3                                      shezhi(0);
 227   3                             }
C51 COMPILER V9.01   KEYPAD                                                                08/12/2018 22:02:29 PAGE 5   

 228   2                             break;
 229   2      
 230   2                  case 0x7B://æ¸…é™¤
 231   2                                      qingchu();
 232   2                              break;
 233   2      
 234   2                  case 0x77://é€€æ ¼
 235   2                                      Backspace();
 236   2                              break;        
 237   2      
 238   2                  case 0xFF:
 239   2                              //æ²¡æœ‰æŒ‰é”®ç¨‹åº
 240   2                              //...
 241   2                              break;
 242   2              }
 243   1      }
 244          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    539    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
